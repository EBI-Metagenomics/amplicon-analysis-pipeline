
singularity {
    enabled = true
}

workDir = '/hps/nobackup/rdf/metagenomics/service-team/users/chrisata/nf-work'

plugins {
    id 'nf-validation'
}

params {

    input = null
    outdir = null
    
    publish_dir_mode = 'copy'
    help = false
    // Schema validation default options
    validationFailUnrecognisedParams = false
    validationLenientMode            = false
    validationSchemaIgnoreParams     = ''
    validationShowHiddenParams       = false
    validate_params                  = true

    max_memory                 = '128.GB'
    max_cpus                   = 16
    max_time                   = '240.h'

    // Silva databases
    ssu_db_fasta = "/hps/nobackup/rdf/metagenomics/service-team/users/chrisata/scripts_taxdb_nf_test/SILVA-SSU/138.1/SILVA-SSU.fasta"
    ssu_db_tax = "/hps/nobackup/rdf/metagenomics/service-team/users/chrisata/scripts_taxdb_nf_test/SILVA-SSU/138.1/SILVA-SSU-tax.txt"
    ssu_db_otu = "/hps/nobackup/rdf/metagenomics/service-team/users/chrisata/scripts_taxdb_nf_test/SILVA-SSU/138.1/SILVA-SSU.otu"
    ssu_db_mscluster = "/hps/nobackup/rdf/metagenomics/service-team/users/chrisata/scripts_taxdb_nf_test/SILVA-SSU/138.1/SILVA-SSU.fasta.mscluster"
    ssu_label = "SSU"

    lsu_db_fasta = "/hps/nobackup/rdf/metagenomics/service-team/users/chrisata/scripts_taxdb_nf_test/SILVA-LSU/138.1/SILVA-LSU.fasta"
    lsu_db_tax = "/hps/nobackup/rdf/metagenomics/service-team/users/chrisata/scripts_taxdb_nf_test/SILVA-LSU/138.1/SILVA-LSU-tax.txt"
    lsu_db_otu = "/hps/nobackup/rdf/metagenomics/service-team/users/chrisata/scripts_taxdb_nf_test/SILVA-LSU/138.1/SILVA-LSU.otu"
    lsu_db_mscluster = "/hps/nobackup/rdf/metagenomics/service-team/users/chrisata/scripts_taxdb_nf_test/SILVA-LSU/138.1/SILVA-LSU.fasta.mscluster"
    lsu_label = "LSU"
    
    silva_dada2_db = "/hps/nobackup/rdf/metagenomics/service-team/users/chrisata/scripts_taxdb_nf_test/DADA2-SILVA/138.1/SILVA_dada2_NR99.fasta.gz"
    dada2_silva_label = "DADA2-SILVA"

    pr2_dada2_db = "/hps/nobackup/rdf/metagenomics/service-team/users/chrisata/scripts_taxdb_nf_test/DADA2-PR2/5.0.0/pr2_version_5.0.0_SSU_dada2.fasta.gz"
    dada2_pr2_label = "DADA2-PR2"

    // UNITE database
    unite_db_fasta = "/hps/nobackup/rdf/metagenomics/service-team/users/chrisata/scripts_taxdb_nf_test/UNITE/9.0/UNITE.fasta"
    unite_db_tax = "/hps/nobackup/rdf/metagenomics/service-team/users/chrisata/scripts_taxdb_nf_test/UNITE/9.0/UNITE-tax.txt"
    unite_db_otu = "/hps/nobackup/rdf/metagenomics/service-team/users/chrisata/scripts_taxdb_nf_test/UNITE/9.0/UNITE.otu"
    unite_db_mscluster = "/hps/nobackup/rdf/metagenomics/service-team/users/chrisata/scripts_taxdb_nf_test/UNITE/9.0/UNITE.fasta.mscluster"
    unite_label = "UNITE"

    // ITSone database
    itsone_db_fasta = "/hps/nobackup/rdf/metagenomics/service-team/users/chrisata/scripts_taxdb_nf_test/ITSone/1.141/ITSone_updated.fasta"
    itsone_db_tax = "/hps/nobackup/rdf/metagenomics/service-team/users/chrisata/scripts_taxdb_nf_test/ITSone/1.141/ITSone-tax_updated.txt"
    itsone_db_otu = "/hps/nobackup/rdf/metagenomics/service-team/users/chrisata/scripts_taxdb_nf_test/ITSone/1.141/ITSone.otu"
    itsone_db_mscluster = "/hps/nobackup/rdf/metagenomics/service-team/users/chrisata/scripts_taxdb_nf_test/ITSone/1.141/ITSone_updated.fasta.mscluster"
    itsone_label = "ITSonedb"

    // PR2 database
    pr2_db_fasta = "/hps/nobackup/rdf/metagenomics/service-team/users/chrisata/scripts_taxdb_nf_test/PR2/5.0.0/PR2.fasta"
    pr2_db_tax = "/hps/nobackup/rdf/metagenomics/service-team/users/chrisata/scripts_taxdb_nf_test/PR2/5.0.0/PR2-tax.txt"
    pr2_db_otu = "/hps/nobackup/rdf/metagenomics/service-team/users/chrisata/scripts_taxdb_nf_test/PR2/5.0.0/PR2.otu"
    pr2_db_mscluster = "/hps/nobackup/rdf/metagenomics/service-team/users/chrisata/scripts_taxdb_nf_test/PR2/5.0.0/PR2.fasta.mscluster"
    pr2_label = "PR2"

    // rfam
    rfam = "/hps/nobackup/rdf/metagenomics/service-team/users/chrisata/scripts_taxdb_nf_test/RFAM/14.10/ribo.cm"
    claninfo = "/hps/nobackup/rdf/metagenomics/service-team/users/chrisata/scripts_taxdb_nf_test/RFAM/14.10/ribo.clan_info"

    std_primer_library = "/hps/software/users/rdf/metagenomics/service-team/users/chrisata/asv_gen/data/standard_primers"

    save_trimmed_fail = true
}

includeConfig 'conf/base.config'
includeConfig 'conf/codon_slurm.config'
includeConfig 'conf/modules.config'

// Function to ensure that resource requirements don't go beyond
// a maximum limit
def check_max(obj, type) {
    if (type == 'memory') {
        try {
            if (obj.compareTo(params.max_memory as nextflow.util.MemoryUnit) == 1)
                return params.max_memory as nextflow.util.MemoryUnit
            else
                return obj
        } catch (all) {
            println "   ### ERROR ###   Max memory '${params.max_memory}' is not valid! Using default value: $obj"
            return obj
        }
    } else if (type == 'time') {
        try {
            if (obj.compareTo(params.max_time as nextflow.util.Duration) == 1)
                return params.max_time as nextflow.util.Duration
            else
                return obj
        } catch (all) {
            println "   ### ERROR ###   Max time '${params.max_time}' is not valid! Using default value: $obj"
            return obj
        }
    } else if (type == 'cpus') {
        try {
            return Math.min( obj, params.max_cpus as int )
        } catch (all) {
            println "   ### ERROR ###   Max cpus '${params.max_cpus}' is not valid! Using default value: $obj"
            return obj
        }
    }
}